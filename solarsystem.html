<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=0.5, maximum-scale=3.0">
    <title>××¢×¨×›×ª ×”×©××© - ×¡×™××•×œ×¦×™×” ×¨×™××œ×™×¡×˜×™×ª</title>
    <meta name="theme-color" content="#000033">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="×¡×™××•×œ×¦×™×” ××™× ×˜×¨××§×˜×™×‘×™×ª ×ª×œ×ª-×××“×™×ª ×©×œ ××¢×¨×›×ª ×”×©××© ×¢× ××™×“×¢ ××¤×•×¨×˜ ×¢×œ ×›×œ ×›×•×›×‘ ×œ×›×ª">
    <link rel="manifest" href="manifest.json">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            overflow: hidden;
            background: #000;
            color: white;
            touch-action: pan-x pan-y;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            touch-action: none;
            cursor: grab;
            background: radial-gradient(ellipse at center, #0a0a2e 0%, #000000 100%);
        }
        
        #canvas-container:active {
            cursor: grabbing;
        }
        
        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(10,10,46,0.85) 100%);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100,100,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            z-index: 100;
            max-width: 320px;
            transition: transform 0.3s ease;
        }
        
        #controls.collapsed {
            transform: translateX(calc(-100% + 50px));
        }
        
        #controls.ruler-hidden .control-group.ruler-group {
            display: none;
        }
        
        #menu-toggle {
            position: absolute;
            right: -40px;
            top: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 0 10px 10px 0;
            color: white;
            cursor: pointer;
            font-size: 20px;
            display: none;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
        }
        
        #controls h1 {
            font-size: 20px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(102,126,234,0.5);
        }
        
        .control-group {
            margin: 12px 0;
        }
        
        .info-text {
            margin-top: 10px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%);
            border-radius: 8px;
            font-size: 11px;
            color: #b8b8ff;
            line-height: 1.4;
            border: 1px solid rgba(100,100,255,0.2);
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            color: #b8b8ff;
            text-shadow: 0 0 5px rgba(100,100,255,0.3);
        }
        
        input[type="range"] {
            width: 100%;
            margin: 5px 0;
            height: 6px;
            background: linear-gradient(90deg, rgba(102,126,234,0.3) 0%, rgba(240,147,251,0.3) 100%);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: radial-gradient(circle, #f093fb 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(240,147,251,0.5);
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            margin: 3px;
            transition: all 0.3s;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(102,126,234,0.3);
        }
        
        button:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 25px rgba(102,126,234,0.5);
        }
        
        button.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 4px 15px rgba(240,147,251,0.4);
        }
        
        #info-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(10,10,46,0.9) 100%);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,215,0,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            max-width: 350px;
            display: none;
            z-index: 100;
            animation: slideIn 0.3s ease-out;
            max-height: 75vh;
            overflow-y: auto;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        #info-panel h2 {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 20px;
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        .info-item {
            margin: 8px 0;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255,215,0,0.1);
        }
        
        .info-label {
            color: #888;
            font-size: 11px;
            margin-bottom: 2px;
        }
        
        .info-value {
            color: #fff;
            font-size: 13px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(255,255,255,0.3);
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,0,0,0.3);
            border: 1px solid rgba(255,0,0,0.5);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .close-btn:hover {
            background: rgba(255,0,0,0.5);
            transform: scale(1.1);
        }
        
        #install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 12px 25px;
            border-radius: 25px;
            display: none;
            z-index: 200;
            animation: bounceIn 0.5s ease-out;
            box-shadow: 0 5px 20px rgba(102,126,234,0.5);
        }
        
        @keyframes bounceIn {
            0% {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            100% {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 1000;
        }
        
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
            box-shadow: 0 0 20px rgba(102,126,234,0.5);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #touch-controls {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            z-index: 90;
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(10,10,46,0.7) 100%);
            padding: 10px 20px;
            border-radius: 20px;
            color: #b8b8ff;
            font-size: 12px;
            border: 1px solid rgba(100,100,255,0.2);
            backdrop-filter: blur(10px);
        }
        
        @media (max-width: 768px) {
            #controls {
                top: 10px;
                left: 10px;
                padding: 12px;
                max-width: 280px;
                font-size: 12px;
            }
            
            #menu-toggle {
                display: block;
            }
            
            #info-panel {
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                max-height: 50vh;
            }
            
            #controls h1 {
                font-size: 18px;
            }
            
            button {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            #touch-controls {
                display: block;
            }
        }
        
        @media (max-width: 400px) {
            #controls {
                max-width: 240px;
            }
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="loader"></div>
        <div>×˜×•×¢×Ÿ ××ª ××¢×¨×›×ª ×”×©××©...</div>
    </div>
    
    <div id="canvas-container"></div>
    
    <div id="controls">
        <button id="menu-toggle">â˜°</button>
        <h1>ğŸŒŒ ××¢×¨×›×ª ×”×©××©</h1>
        
        <div class="control-group ruler-group">
            <label>××”×™×¨×•×ª ×¡×™×‘×•×‘: <span id="speed-value">1</span>x</label>
            <input type="range" id="speed-slider" min="0" max="100" value="1" step="0.1">
        </div>
        
        <div class="control-group ruler-group">
            <label>×–×•×:</label>
            <input type="range" id="zoom-slider" min="50" max="500" value="200">
        </div>
        
        <div class="control-group">
            <button id="pause-btn">â¸ï¸ ×”×©×”×”</button>
            <button id="reset-btn">ğŸ”„ ××¤×¡</button>
            <button id="ruler-toggle-btn" class="active">ğŸ“ ×¡×¨×’×œ×™×</button>
        </div>
        
        <div class="control-group">
            <button id="orbits-btn" class="active">ğŸŒ ××¡×œ×•×œ×™×</button>
            <button id="asteroid-btn" class="active">â˜„ï¸ ××¡×˜×¨×•××™×“×™×</button>
            <button id="labels-btn" class="active">ğŸ·ï¸ ×ª×•×•×™×•×ª</button>
        </div>
        
        <div class="info-text">
            âœ¨ ×’×¨×¤×™×§×” ×¨×™××œ×™×¡×˜×™×ª<br>
            ğŸª ××¡×œ×•×œ×™× ××œ×™×¤×˜×™×™× ××“×•×™×§×™×<br>
            â˜„ï¸ 500 ××¡×˜×¨×•××™×“×™× ×‘×—×’×•×¨×”<br>
            ğŸŒ‘ ×¦×œ×œ×™× ×¨×™××œ×™×¡×˜×™×™×<br>
            ğŸŒ™ ×™×¨×— ××¡×ª×•×‘×‘ ×¡×‘×™×‘ ×›×“×•×¨ ×”××¨×¥
        </div>
    </div>
    
    <div id="info-panel">
        <button class="close-btn">âœ•</button>
        <h2 id="planet-name"></h2>
        <div class="info-item">
            <div class="info-label">×§×•×˜×¨</div>
            <div class="info-value" id="planet-diameter"></div>
        </div>
        <div class="info-item">
            <div class="info-label">××¨×—×§ ××”×©××©</div>
            <div class="info-value" id="planet-distance"></div>
        </div>
        <div class="info-item">
            <div class="info-label">×–××Ÿ ×”×§×¤×”</div>
            <div class="info-value" id="planet-period"></div>
        </div>
        <div class="info-item">
            <div class="info-label">××©×š ×™×××”</div>
            <div class="info-value" id="planet-day"></div>
        </div>
        <div class="info-item">
            <div class="info-label">×™×¨×—×™×</div>
            <div class="info-value" id="planet-moons"></div>
        </div>
        <div class="info-item">
            <div class="info-label">×˜××¤×¨×˜×•×¨×” ×××•×¦×¢×ª</div>
            <div class="info-value" id="planet-temp"></div>
        </div>
        <div class="info-item">
            <div class="info-label">××¡×” (×‘×™×—×¡ ×œ×›×“×•×¨ ×”××¨×¥)</div>
            <div class="info-value" id="planet-mass"></div>
        </div>
        <div class="info-item">
            <div class="info-label">×›×•×— ××©×™×›×” (×‘×™×—×¡ ×œ×›×“×•×¨ ×”××¨×¥)</div>
            <div class="info-value" id="planet-gravity"></div>
        </div>
        <div class="info-item">
            <div class="info-label">×”×¨×›×‘</div>
            <div class="info-value" id="planet-composition"></div>
        </div>
        <div class="info-item">
            <div class="info-label">××˜××•×¡×¤×™×¨×”</div>
            <div class="info-value" id="planet-atmosphere"></div>
        </div>
        <div class="info-item">
            <div class="info-label">××§×¡×¦× ×˜×¨×™×•×ª ×”××¡×œ×•×œ</div>
            <div class="info-value" id="planet-eccentricity"></div>
        </div>
        <div class="info-item">
            <div class="info-label">×¢×•×‘×“×•×ª ××¢× ×™×™× ×•×ª</div>
            <div class="info-value" id="planet-facts"></div>
        </div>
    </div>
    
    <div id="install-prompt">
        <button id="install-btn">ğŸ“± ×”×ª×§×Ÿ ×›××¤×œ×™×§×¦×™×”</button>
    </div>
    
    <div id="touch-controls">
        ğŸ‘† ×”×§×© ×¢×œ ×›×•×›×‘ | ğŸ¤ ×¦×‘×•×˜ ×œ×–×•× | â˜ï¸ ×’×¨×•×¨ ×œ××¢×œ×”/×œ××˜×”/×œ×¦×“×“×™×
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Global variables
        let scene, camera, renderer, raycaster, mouse;
        let sun, sunGroup, planets = [], orbits = [], asteroids = [], labels = [], asteroidEffects = [];
        let isPaused = false, showOrbits = true, showAsteroids = true, showLabels = true, showRulers = true;
        let speedMultiplier = 1;
        let selectedPlanet = null;
        let touchStartDistance = 0;
        let currentCameraDistance = 200;
        let cameraRotationAngle = 0;
        let cameraVerticalAngle = 0.3;
        let isDragging = false;
        let startTime = Date.now();
        
        // Sun data
        const sunData = {
            name: '×”×©××©',
            radius: 8,
            diameter: '1,391,400 ×§"×',
            realDistance: '0 ×§"× (××¨×›×– ×”××¢×¨×›×ª)',
            period: '×œ× ×¨×œ×•×•× ×˜×™',
            dayLength: '25 ×™××™ ××¨×¥ (×‘×§×• ×”××©×•×•×”)',
            moons: '×œ× ×¨×œ×•×•× ×˜×™',
            temp: '5,500Â°C (×¤× ×™ ×”×©×˜×—) | 15 ××™×œ×™×•×ŸÂ°C (×”×œ×™×‘×”)',
            mass: '333,000 (×‘×™×—×¡ ×œ×›×“×•×¨ ×”××¨×¥)',
            gravity: '28 (×‘×™×—×¡ ×œ×›×“×•×¨ ×”××¨×¥)',
            composition: '73% ××™××Ÿ, 25% ×”×œ×™×•×, 2% ×™×¡×•×“×•×ª ×›×‘×“×™× ×™×•×ª×¨',
            atmosphere: '×›×¨×•××•×¡×¤×™×¨×” ×•×§×•×¨×•× ×” - ×¤×œ×–××” ×—××”',
            eccentricity: 0,
            facts: '××”×•×•×” 99.86% ×××¡×ª ××¢×¨×›×ª ×”×©××© | ×›×•×›×‘ ××¡×•×’ G (× × ×¡ ×¦×”×•×‘) | ×‘×Ÿ 4.6 ××™×œ×™××¨×“ ×©× ×” | ×¦×¤×•×™ ×œ×—×™×•×ª ×¢×•×“ 5 ××™×œ×™××¨×“ ×©× ×” | ××™×™×¦×¨×ª ×× ×¨×’×™×” ×“×¨×š ×”×™×ª×•×š ×’×¨×¢×™× ×™'
        };
        
        // Planet data - ××™×“×¢ ××•×¨×—×‘
        const planetsData = {
            mercury: {
                name: '×›×•×›×‘ ×—××”',
                radius: 0.38,
                distance: 10,
                eccentricity: 0.206,
                speed: 4.15,
                rotationSpeed: 0.001,
                axialTilt: 0.034,
                diameter: '4,879 ×§"×',
                realDistance: '57.9 ××™×œ×™×•×Ÿ ×§"×',
                period: '88 ×™××™×',
                dayLength: '59 ×™××™ ××¨×¥',
                moons: '0',
                temp: '167Â°C (×××•×¦×¢) | 430Â°C (×™×•×) | -180Â°C (×œ×™×œ×”)',
                mass: '0.055',
                gravity: '0.38',
                composition: '×¡×œ×¢×™, ×œ×™×‘×ª ×‘×¨×–×œ ×’×“×•×œ×”',
                atmosphere: '×›××¢×˜ ××™×Ÿ - ×¢×§×‘×•×ª ×©×œ ×—××¦×Ÿ, × ×ª×¨×Ÿ, ××™××Ÿ ×•×”×œ×™×•×',
                facts: '×”×›×•×›×‘ ×”×§×˜×Ÿ ×‘×™×•×ª×¨ ×‘××¢×¨×›×ª ×”×©××© | ×™×•× ××—×“ ×¢×œ ×—××” ××¨×•×š ××”×©× ×” ×©×œ×• | ××™×Ÿ ×¢×•× ×•×ª ×”×©× ×”',
                textureColors: [0x8C7853, 0x705548, 0x9B8873],
                angle: 0
            },
            venus: {
                name: '× ×•×’×”',
                radius: 0.95,
                distance: 15,
                eccentricity: 0.007,
                speed: 1.62,
                rotationSpeed: -0.0001,
                axialTilt: 2.64,
                diameter: '12,104 ×§"×',
                realDistance: '108.2 ××™×œ×™×•×Ÿ ×§"×',
                period: '225 ×™××™×',
                dayLength: '243 ×™××™ ××¨×¥',
                moons: '0',
                temp: '464Â°C',
                mass: '0.815',
                gravity: '0.90',
                composition: '×¡×œ×¢×™, ×“×•××” ×œ×›×“×•×¨ ×”××¨×¥',
                atmosphere: '96.5% ×¤×—××Ÿ ×“×•-×—××¦× ×™, 3.5% ×—× ×§×Ÿ, ×¢×§×‘×•×ª ×©×œ ×’×•×¤×¨×™×ª ×“×•-×—××¦× ×™×ª',
                facts: '×”×›×•×›×‘ ×”×—× ×‘×™×•×ª×¨ ×‘××¢×¨×›×ª ×”×©××© | ××¡×ª×•×‘×‘ ×‘×›×™×•×•×Ÿ ×”×¤×•×š | × ×§×¨× "×›×•×›×‘ ×”×‘×•×§×¨" ××• "×›×•×›×‘ ×”×¢×¨×‘" | ×’×©× ×©×œ ×—×•××¦×” ×’×•×¤×¨×ª×™×ª',
                textureColors: [0xFFC649, 0xFFD873, 0xFFE4A3],
                hasAtmosphere: true,
                angle: 0
            },
            earth: {
                name: '×›×“×•×¨ ×”××¨×¥',
                radius: 1,
                distance: 20,
                eccentricity: 0.017,
                speed: 1,
                rotationSpeed: 0.01,
                axialTilt: 0.41,
                diameter: '12,742 ×§"×',
                realDistance: '149.6 ××™×œ×™×•×Ÿ ×§"×',
                period: '365.25 ×™××™×',
                dayLength: '24 ×©×¢×•×ª',
                moons: '1 (×”×™×¨×—)',
                temp: '15Â°C',
                mass: '1.00',
                gravity: '1.00',
                composition: '×¡×œ×¢×™, 71% ××™× ×¢×œ ×¤× ×™ ×”×©×˜×—',
                atmosphere: '78% ×—× ×§×Ÿ, 21% ×—××¦×Ÿ, 1% ××¨×’×•×Ÿ ×•×’×–×™× ××—×¨×™×',
                facts: '×”×›×•×›×‘ ×”×™×—×™×“ ×”×™×“×•×¢ ×¢× ×—×™×™× | ×”×¦×¤×™×¤×•×ª ×”×’×‘×•×”×” ×‘×™×•×ª×¨ ××‘×™×Ÿ ×›×•×›×‘×™ ×”×œ×›×ª ×”×¡×œ×¢×™×™× | ×˜×§×˜×•× ×™×§×ª ×œ×•×—×•×ª ×¤×¢×™×œ×”',
                textureColors: [0x2233FF, 0x4466FF, 0x1a5f1a],
                hasAtmosphere: true,
                hasClouds: true,
                angle: 0
            },
            mars: {
                name: '×××“×™×',
                radius: 0.53,
                distance: 28,
                eccentricity: 0.093,
                speed: 0.53,
                rotationSpeed: 0.01,
                axialTilt: 0.44,
                diameter: '6,779 ×§"×',
                realDistance: '227.9 ××™×œ×™×•×Ÿ ×§"×',
                period: '687 ×™××™×',
                dayLength: '24.6 ×©×¢×•×ª',
                moons: '2 (×¤×•×‘×•×¡ ×•×“×™××•×¡)',
                temp: '-65Â°C',
                mass: '0.107',
                gravity: '0.38',
                composition: '×¡×œ×¢×™, ×ª×—××•×¦×ª ×‘×¨×–×œ ×¢×œ ×¤× ×™ ×”×©×˜×—',
                atmosphere: '95% ×¤×—××Ÿ ×“×•-×—××¦× ×™, 3% ×—× ×§×Ÿ, 1.6% ××¨×’×•×Ÿ',
                facts: '×”×”×¨ ×”×’×‘×•×” ×‘×™×•×ª×¨ ×‘××¢×¨×›×ª ×”×©××© (××•×œ×™××¤×•×¡ ××•× ×¡ - 21 ×§"×) | ×¢×•× ×•×ª ×©× ×” ×“×•××•×ª ×œ×›×“×•×¨ ×”××¨×¥ | ×¡×•×¤×•×ª ××‘×§ ×’×œ×•×‘×œ×™×•×ª',
                textureColors: [0xFF4500, 0xCD3700, 0xFF6347],
                hasAtmosphere: true,
                angle: 0
            },
            jupiter: {
                name: '×¦×“×§',
                radius: 5,
                distance: 50,
                eccentricity: 0.049,
                speed: 0.084,
                rotationSpeed: 0.02,
                axialTilt: 0.05,
                diameter: '139,820 ×§"×',
                realDistance: '778.5 ××™×œ×™×•×Ÿ ×§"×',
                period: '11.9 ×©× ×™×',
                dayLength: '9.9 ×©×¢×•×ª',
                moons: '95 ×™×“×•×¢×™× (4 ×’×“×•×œ×™×: ××™×•, ××™×¨×•×¤×”, ×’× ×™××“, ×§×œ×™×¡×˜×•)',
                temp: '-110Â°C',
                mass: '317.8',
                gravity: '2.36',
                composition: '×’×–, ×‘×¢×™×§×¨ ××™××Ÿ ×•×”×œ×™×•×',
                atmosphere: '89% ××™××Ÿ, 10% ×”×œ×™×•×, 1% ××ª××Ÿ ×•×××•× ×™×”',
                facts: '×”×›×•×›×‘ ×”×’×“×•×œ ×‘×™×•×ª×¨ | ×”×›×ª× ×”××“×•× ×”×’×“×•×œ - ×¡×•×¤×” ×©× ××©×›×ª ×××•×ª ×©× ×™× | ××’×Ÿ ×¢×œ ×›×“×•×¨ ×”××¨×¥ ×××¡×˜×¨×•××™×“×™× | ×™×•× ×”×§×¦×¨ ×‘×™×•×ª×¨',
                textureColors: [0xC88B3A, 0xB8860B, 0xD2691E, 0xF4A460],
                hasStripes: true,
                angle: 0
            },
            saturn: {
                name: '×©×‘×ª××™',
                radius: 4.5,
                distance: 70,
                eccentricity: 0.052,
                speed: 0.034,
                rotationSpeed: 0.018,
                axialTilt: 0.47,
                diameter: '116,460 ×§"×',
                realDistance: '1.434 ××™×œ×™××¨×“ ×§"×',
                period: '29.5 ×©× ×™×',
                dayLength: '10.7 ×©×¢×•×ª',
                moons: '146 ×™×“×•×¢×™× (×˜×™×˜××Ÿ ×”×’×“×•×œ ×‘×™×•×ª×¨)',
                temp: '-140Â°C',
                mass: '95.2',
                gravity: '1.06',
                composition: '×’×–, ×˜×‘×¢×•×ª ×§×¨×— ×•×¡×œ×¢',
                atmosphere: '96% ××™××Ÿ, 3% ×”×œ×™×•×, 1% ××ª××Ÿ',
                facts: '×¦×¤×™×¤×•×ª × ××•×›×” ×××™× - ×™×¦×•×£ ×‘××•×§×™×™× ×•×¡ ×¢× ×§ | ×˜×‘×¢×•×ª ××•×¨×›×‘×•×ª ×××œ×¤×™ ×˜×‘×¢×•×ª ×§×˜× ×•×ª | ×˜×™×˜××Ÿ - ×™×¨×— ×¢× ××˜××•×¡×¤×™×¨×” ×¦×¤×•×¤×”',
                textureColors: [0xFAD5A5, 0xFFE4B5, 0xF5DEB3],
                hasRings: true,
                hasStripes: true,
                angle: 0
            },
            uranus: {
                name: '××•×¨× ×•×¡',
                radius: 2,
                distance: 90,
                eccentricity: 0.047,
                speed: 0.012,
                rotationSpeed: -0.01,
                axialTilt: 1.71,
                diameter: '50,724 ×§"×',
                realDistance: '2.871 ××™×œ×™××¨×“ ×§"×',
                period: '84 ×©× ×™×',
                dayLength: '17.2 ×©×¢×•×ª',
                moons: '27 ×™×“×•×¢×™×',
                temp: '-195Â°C',
                mass: '14.5',
                gravity: '0.89',
                composition: '×§×¨×— ×•××ª××Ÿ',
                atmosphere: '83% ××™××Ÿ, 15% ×”×œ×™×•×, 2% ××ª××Ÿ',
                facts: '××¡×ª×•×‘×‘ ×¢×œ ×¦×™×“×• (× ×˜×™×™×” ×©×œ 98Â°) | ×’×™×œ×•×™ ×¢×œ ×™×“×™ ×•×™×œ×™×× ×”×¨×©×œ ×‘-1781 | ×˜×‘×¢×•×ª ×—×œ×©×•×ª ×”×ª×’×œ×• ×‘-1977',
                textureColors: [0x4FD0E7, 0x5FE0F7],
                hasRings: true,
                angle: 0
            },
            neptune: {
                name: '× ×¤×˜×•×Ÿ',
                radius: 1.95,
                distance: 110,
                eccentricity: 0.009,
                speed: 0.006,
                rotationSpeed: 0.012,
                axialTilt: 0.49,
                diameter: '49,244 ×§"×',
                realDistance: '4.495 ××™×œ×™××¨×“ ×§"×',
                period: '165 ×©× ×™×',
                dayLength: '16.1 ×©×¢×•×ª',
                moons: '16 ×™×“×•×¢×™× (×˜×¨×™×˜×•×Ÿ ×”×’×“×•×œ ×‘×™×•×ª×¨)',
                temp: '-200Â°C',
                mass: '17.1',
                gravity: '1.14',
                composition: '×§×¨×—, ××ª××Ÿ, ×××•× ×™×”',
                atmosphere: '80% ××™××Ÿ, 19% ×”×œ×™×•×, 1% ××ª××Ÿ',
                facts: '×”×¨×•×—×•×ª ×”××”×™×¨×•×ª ×‘×™×•×ª×¨ ×‘××¢×¨×›×ª ×”×©××© (2,100 ×§×"×©) | ×”×ª×’×œ×” ×‘×××¦×¢×•×ª ×—×™×©×•×‘×™× ××ª××˜×™×™× | ×˜×¨×™×˜×•×Ÿ ××¡×ª×•×‘×‘ ×‘×›×™×•×•×Ÿ ×”×¤×•×š',
                textureColors: [0x4B70DD, 0x3A5FCD],
                hasRings: true,
                angle: 0
            }
        };
        
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.layers.enableAll();
            updateCameraPosition();
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true,
                powerPreference: "high-performance",
                precision: "highp",
                preserveDrawingBuffer: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 0.6;
            renderer.outputEncoding = THREE.sRGBEncoding;
            renderer.physicallyCorrectLights = true;
            renderer.sortObjects = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Raycaster
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404080, 0.25); // ×”×¨×‘×” ×™×•×ª×¨ ×‘×”×™×¨!
            scene.add(ambientLight);
            
            const sunLight = new THREE.PointLight(0xffffff, 3, 500);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);
            
            const hemiLight = new THREE.HemisphereLight(0x4040ff, 0x202040, 0.2);
            scene.add(hemiLight);
            
            // Create content
            createStarfield();
            createSun();
            
            for (const [key, data] of Object.entries(planetsData)) {
                createPlanet(data);
            }
            
            createAsteroidBelt();
            createPlanetaryRings();
            
            // Setup controls
            setupTouchControls();
            setupMouseControls();
            
            // Event listeners
            window.addEventListener('click', onPointerClick);
            if (renderer && renderer.domElement) {
                renderer.domElement.addEventListener('touchend', onPointerClick);
            }
            
            // Hide loading
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }
        
        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xFFFFFF,
                size: 0.7,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }
        
        function createSun() {
            sunGroup = new THREE.Group();
            
            const sunGeometry = new THREE.SphereGeometry(8, 64, 64);
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: 0xFFFAE6
            });
            
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.userData = sunData;  // ×”×•×¡×¤×ª ××™×“×¢ ×¢×œ ×”×©××©
            sunGroup.add(sun);
            
            for (let i = 1; i <= 3; i++) {
                const glowGeometry = new THREE.SphereGeometry(8 + i * 4, 32, 32);
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: i === 1 ? 0xFFD700 : i === 2 ? 0xFFA500 : 0xFF8C00,
                    transparent: true,
                    opacity: 0.3 / i,
                    side: THREE.BackSide,
                    depthWrite: false
                });
                const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                sunGroup.add(glow);
            }
            
            // ×”×•×¡×¤×ª ×ª×•×•×™×ª ×œ×©××©
            const lblCanvas = document.createElement('canvas');
            const lblCtx = lblCanvas.getContext('2d');
            lblCanvas.width = 256;
            lblCanvas.height = 64;
            
            lblCtx.shadowColor = 'rgba(255, 215, 0, 0.8)';
            lblCtx.shadowBlur = 15;
            lblCtx.fillStyle = '#FFD700';
            lblCtx.font = 'bold 32px Arial';
            lblCtx.textAlign = 'center';
            lblCtx.fillText('×”×©××© â˜€ï¸', 128, 40);
            
            const lblTex = new THREE.CanvasTexture(lblCanvas);
            const lblMat = new THREE.SpriteMaterial({ 
                map: lblTex,
                transparent: true
            });
            const lblSprite = new THREE.Sprite(lblMat);
            lblSprite.scale.set(12, 3, 1);
            lblSprite.position.y = 12;
            sunGroup.add(lblSprite);
            labels.push(lblSprite);
            
            scene.add(sunGroup);
        }

        function createPlanetTexture(data) {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    const size = 512;
    canvas.width = size;
    canvas.height = size;
    
    // ×™×¦×™×¨×ª ×˜×§×¡×˜×•×¨×” ×œ×¤×™ ×¡×•×’ ×”×›×•×›×‘
    switch(data.name) {
        case '×›×•×›×‘ ×—××”':
            createMercuryTexture(ctx, size);
            break;
        case '× ×•×’×”':
            createVenusTexture(ctx, size);
            break;
        case '×›×“×•×¨ ×”××¨×¥':
            createEarthTexture(ctx, size);
            break;
        case '×××“×™×':
            createMarsTexture(ctx, size);
            break;
        case '×¦×“×§':
            createJupiterTexture(ctx, size);
            break;
        case '×©×‘×ª××™':
            createSaturnTexture(ctx, size);
            break;
        case '××•×¨× ×•×¡':
            createUranusTexture(ctx, size);
            break;
        case '× ×¤×˜×•×Ÿ':
            createNeptuneTexture(ctx, size);
            break;
        default:
            createGenericTexture(ctx, size, data.textureColors[0]);
    }
    
    return new THREE.CanvasTexture(canvas);
}

function createMercuryTexture(ctx, size) {
    // ×¨×§×¢ ×‘×”×™×¨ ×™×•×ª×¨
    const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
    gradient.addColorStop(0, '#D4C4A8'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(0.5, '#C8B896'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(1, '#A68B5B'); // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // ××›×ª×©×™× ×‘×”×™×¨×™× ×™×•×ª×¨
    for (let i = 0; i < 80; i++) { // ×¤×—×•×ª ××›×ª×©×™×
        const x = Math.random() * size;
        const y = Math.random() * size;
        const radius = Math.random() * 12 + 2;
        const craterGradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
        craterGradient.addColorStop(0, '#888888'); // ×‘×”×™×¨ ×™×•×ª×¨
        craterGradient.addColorStop(1, '#AAAAAA'); // ×‘×”×™×¨ ×™×•×ª×¨
        ctx.fillStyle = craterGradient;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fill();
    }
}

function createVenusTexture(ctx, size) {
    // ×¨×§×¢ ×‘×”×™×¨ ×•×™×¤×”
    const gradient = ctx.createLinearGradient(0, 0, size, size);
    gradient.addColorStop(0, '#FFE4A3'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(0.3, '#FFD873'); 
    gradient.addColorStop(0.7, '#FFF0B8'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(1, '#FFCC80'); // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // ×¢× × ×™× ×‘×”×™×¨×™×
    for (let i = 0; i < 40; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const cloudSize = Math.random() * 35 + 15;
        const cloudGradient = ctx.createRadialGradient(x, y, 0, x, y, cloudSize);
        cloudGradient.addColorStop(0, 'rgba(255, 255, 255, 0.5)'); // ×‘×”×™×¨ ×™×•×ª×¨
        cloudGradient.addColorStop(1, 'rgba(255, 230, 150, 0.2)'); // ×‘×”×™×¨ ×™×•×ª×¨
        ctx.fillStyle = cloudGradient;
        ctx.beginPath();
        ctx.arc(x, y, cloudSize, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // ×§×•×•×™ ××˜××•×¡×¤×™×¨×” ×‘×”×™×¨×™×
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.4)'; // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.lineWidth = 1;
    for (let i = 0; i < 15; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * size / 15);
        ctx.quadraticCurveTo(size/2, i * size / 15 + Math.sin(i) * 20, size, i * size / 15);
        ctx.stroke();
    }
}

function createEarthTexture(ctx, size) {
    // ××•×§×™×™× ×•×¡ ×›×—×•×œ ×‘×”×™×¨
    ctx.fillStyle = '#4466FF'; // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.fillRect(0, 0, size, size);
    
    // ×™×‘×©×•×ª ×™×¨×•×§×•×ª ×‘×”×™×¨×•×ª
    const continents = [
        {x: size*0.2, y: size*0.3, w: size*0.3, h: size*0.4},
        {x: size*0.6, y: size*0.2, w: size*0.25, h: size*0.5},
        {x: size*0.1, y: size*0.7, w: size*0.4, h: size*0.2}
    ];
    
    ctx.fillStyle = '#2E8B2E'; // ×™×¨×•×§ ×‘×”×™×¨ ×™×•×ª×¨
    continents.forEach(continent => {
        ctx.beginPath();
        ctx.ellipse(continent.x, continent.y, continent.w/2, continent.h/2, 0, 0, Math.PI * 2);
        ctx.fill();
    });
    
    // ×”×•×¡×¤×ª ×—×•××™× ×œ×—×•×¤×™×
    ctx.fillStyle = '#DEB887';
    continents.forEach(continent => {
        ctx.beginPath();
        ctx.ellipse(continent.x, continent.y, continent.w/2.5, continent.h/2.5, 0, 0, Math.PI * 2);
        ctx.fill();
    });
    
    // ×¢× × ×™× ×‘×”×™×¨×™×
    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)'; // ×‘×”×™×¨ ×™×•×ª×¨
    for (let i = 0; i < 25; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const cloudSize = Math.random() * 20 + 8;
        ctx.beginPath();
        ctx.arc(x, y, cloudSize, 0, Math.PI * 2);
        ctx.fill();
    }
}

function createMarsTexture(ctx, size) {
    // ×¨×§×¢ ××“×•× ×‘×”×™×¨
    const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
    gradient.addColorStop(0, '#FF7F50'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(0.5, '#FF6347');
    gradient.addColorStop(1, '#E55B3C'); // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // ×›×ª××™× ×›×”×™× ×¤×—×•×ª ×›×”×™×
    ctx.fillStyle = 'rgba(139, 69, 19, 0.4)'; // ×©×§×•×£ ×™×•×ª×¨
    for (let i = 0; i < 15; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const w = Math.random() * 50 + 15;
        const h = Math.random() * 15 + 3;
        ctx.fillRect(x, y, w, h);
    }
    
    // ×§×˜×‘ ×¦×¤×•× ×™ ×œ×‘×Ÿ ×‘×”×™×¨
    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
    ctx.beginPath();
    ctx.arc(size/2, size*0.1, size*0.08, 0, Math.PI * 2);
    ctx.fill();
}
        
function createJupiterTexture(ctx, size) {
    // ×¤×¡×™× ×‘×”×™×¨×™× ×©×œ ×¦×“×§
    const stripes = ['#E6B85C', '#DAA520', '#F4A460', '#FFE4B5', '#F5DEB3']; // ×‘×”×™×¨ ×™×•×ª×¨
    const stripeHeight = size / stripes.length;
    
    for (let i = 0; i < stripes.length; i++) {
        ctx.fillStyle = stripes[i];
        ctx.fillRect(0, i * stripeHeight, size, stripeHeight);
        
        // ×’×œ×™× ×‘×”×™×¨×™×
        ctx.strokeStyle = stripes[i === 0 ? stripes.length - 1 : i - 1];
        ctx.lineWidth = 2;
        ctx.beginPath();
        for (let x = 0; x <= size; x += 5) {
            const waveHeight = Math.sin(x * 0.02 + i) * 8;
            const y = i * stripeHeight + stripeHeight/2 + waveHeight;
            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }
    
    // ×”×›×ª× ×”××“×•× ×”×’×“×•×œ ×‘×”×™×¨
    const spotX = size * 0.7;
    const spotY = size * 0.4;
    const spotGradient = ctx.createRadialGradient(spotX, spotY, 0, spotX, spotY, 35);
    spotGradient.addColorStop(0, '#FF8C69'); // ×‘×”×™×¨ ×™×•×ª×¨
    spotGradient.addColorStop(0.5, '#FF6347');
    spotGradient.addColorStop(1, '#FF4500');
    ctx.fillStyle = spotGradient;
    ctx.beginPath();
    ctx.ellipse(spotX, spotY, 30, 20, 0, 0, Math.PI * 2);
    ctx.fill();
}

function createSaturnTexture(ctx, size) {
    // ×¤×¡×™× ×‘×”×™×¨×™× ×××•×“
    const stripes = ['#FFFACD', '#FFEBCD', '#F5DEB3', '#FFE4B5', '#FFEFD5']; // ×‘×”×™×¨ ×××•×“
    const stripeHeight = size / stripes.length;
    
    for (let i = 0; i < stripes.length; i++) {
        ctx.fillStyle = stripes[i];
        ctx.fillRect(0, i * stripeHeight, size, stripeHeight);
        
        // ×’×œ×™× ×¢×“×™× ×™×
        ctx.strokeStyle = 'rgba(0, 0, 0, 0.05)'; // ×¢×“×™×Ÿ ×××•×“
        ctx.lineWidth = 1;
        ctx.beginPath();
        for (let x = 0; x <= size; x += 5) {
            const waveHeight = Math.sin(x * 0.03 + i) * 3;
            const y = i * stripeHeight + stripeHeight/2 + waveHeight;
            if (x === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
    }
}
        
function createUranusTexture(ctx, size) {
    // ×›×—×•×œ-×™×¨×•×§ ×‘×”×™×¨
    const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
    gradient.addColorStop(0, '#87CEEB'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(1, '#4FD0E7');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // ×¤×¡×™× ×‘×”×™×¨×™×
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)'; // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.lineWidth = 1;
    for (let i = 0; i < 8; i++) {
        ctx.beginPath();
        ctx.moveTo(0, i * size / 8);
        ctx.lineTo(size, i * size / 8);
        ctx.stroke();
    }
}

function createNeptuneTexture(ctx, size) {
    // ×›×—×•×œ ×‘×”×™×¨ ×™×•×ª×¨
    const gradient = ctx.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
    gradient.addColorStop(0, '#6495ED'); // ×‘×”×™×¨ ×™×•×ª×¨
    gradient.addColorStop(1, '#4169E1'); // ×‘×”×™×¨ ×™×•×ª×¨
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, size, size);
    
    // ×›×ª××™× ×‘×”×™×¨×™× ×œ×¡×•×¤×•×ª
    ctx.fillStyle = 'rgba(135, 206, 235, 0.4)'; // ×‘×”×™×¨ ×™×•×ª×¨
    for (let i = 0; i < 8; i++) {
        const x = Math.random() * size;
        const y = Math.random() * size;
        const stormSize = Math.random() * 25 + 8;
        ctx.beginPath();
        ctx.arc(x, y, stormSize, 0, Math.PI * 2);
        ctx.fill();
    }
}

function createGenericTexture(ctx, size, color) {
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, size, size);
}

        
        function createPlanet(data) {
            const planetGroup = new THREE.Group();
            
            const planetGeom = new THREE.SphereGeometry(data.radius, 64, 64);
            
                        // ×™×¦×™×¨×ª ×˜×§×¡×˜×•×¨×” ××•×ª×××ª ××™×©×™×ª
            const texture = createPlanetTexture(data);
            texture.wrapS = THREE.RepeatWrapping;
            texture.wrapT = THREE.RepeatWrapping;
            
            const planetMat = new THREE.MeshPhongMaterial({
            map: texture,
            shininess: data.name === '×›×“×•×¨ ×”××¨×¥' ? 70 : 30,
            specular: data.name === '×›×“×•×¨ ×”××¨×¥' ? 0x111155 : 0x222222,
            bumpMap: texture,
            bumpScale: 0.05,
            emissive: new THREE.Color(0x111111), // ×ª××•×¨×” ×¢×¦××™×ª ×¢×“×™× ×”
            emissiveIntensity: 0.1 // ×¢×•×¦××” × ××•×›×”
        });
            
            const planetMesh = new THREE.Mesh(planetGeom, planetMat);
            planetMesh.castShadow = true;
            planetMesh.receiveShadow = true;
            planetMesh.userData = data;
            planetMesh.rotation.z = data.axialTilt;
            planetGroup.add(planetMesh);
            
            if (data.hasAtmosphere) {
                const atmosGeom = new THREE.SphereGeometry(data.radius * 1.1, 32, 32);
                const atmosMat = new THREE.MeshBasicMaterial({
                    color: data.name === '×›×“×•×¨ ×”××¨×¥' ? 0x4488ff :
                           data.name === '× ×•×’×”' ? 0xFFEEAA :
                           data.name === '×××“×™×' ? 0xFF8866 : 0xFFFFFF,
                    transparent: true,
                    opacity: 0.2,
                    side: THREE.BackSide,
                    depthWrite: false
                });
                const atmosMesh = new THREE.Mesh(atmosGeom, atmosMat);
                planetGroup.add(atmosMesh);
            }
            
            if (data.hasClouds) {
                const cloudGeom = new THREE.SphereGeometry(data.radius * 1.02, 32, 32);
                const cloudMat = new THREE.MeshPhongMaterial({
                    color: 0xFFFFFF,
                    transparent: true,
                    opacity: 0.3,
                    depthWrite: false
                });
                const cloudMesh = new THREE.Mesh(cloudGeom, cloudMat);
                planetMesh.add(cloudMesh);
            }
            
            // Create orbit
            const pathCurve = new THREE.EllipseCurve(
                -data.distance * data.eccentricity, 0,
                data.distance * (1 - data.eccentricity),
                data.distance * (1 - data.eccentricity) * Math.sqrt(1 - data.eccentricity * data.eccentricity),
                0, 2 * Math.PI,
                false,
                0
            );
            
            const pathPoints = pathCurve.getPoints(256);
            const pathGeom = new THREE.BufferGeometry().setFromPoints(pathPoints);
            
            const pathColor = new THREE.Color().setHSL((data.distance / 110) * 0.7 + 0.1, 0.8, 0.7);
            const pathMat = new THREE.LineBasicMaterial({
                color: pathColor,
                linewidth: 2,
                fog: false
            });
            const pathLine = new THREE.Line(pathGeom, pathMat);
            pathLine.rotation.x = Math.PI / 2;
            pathLine.frustumCulled = false;
            pathLine.renderOrder = -100;
            scene.add(pathLine);
            
            const pathGlowMat = new THREE.LineBasicMaterial({
                color: pathColor,
                transparent: true,
                opacity: 0.4,
                linewidth: 5,
                depthWrite: false,
                fog: false
            });
            const pathGlowLine = new THREE.Line(pathGeom, pathGlowMat);
            pathGlowLine.rotation.x = Math.PI / 2;
            pathGlowLine.frustumCulled = false;
            pathGlowLine.renderOrder = -101;
            scene.add(pathGlowLine);
            
            orbits.push(pathLine);
            orbits.push(pathGlowLine);
            
            if (data.name === '×›×“×•×¨ ×”××¨×¥') {
                const moonGeom = new THREE.SphereGeometry(0.27, 16, 16);
                const moonMat = new THREE.MeshPhongMaterial({
                    color: 0xAAAAAA,
                    shininess: 5
                });
                const moonMesh = new THREE.Mesh(moonGeom, moonMat);
                moonMesh.position.x = 2;
                moonMesh.castShadow = true;
                moonMesh.receiveShadow = true;
                planetGroup.add(moonMesh);
                planetGroup.userData.moon = moonMesh;
            }
            
            planetGroup.userData = data;
            
            const lblCanvas = document.createElement('canvas');
            const lblCtx = lblCanvas.getContext('2d');
            lblCanvas.width = 256;
            lblCanvas.height = 64;
            
            lblCtx.shadowColor = 'rgba(255, 255, 255, 0.8)';
            lblCtx.shadowBlur = 10;
            lblCtx.fillStyle = 'white';
            lblCtx.font = 'bold 28px Arial';
            lblCtx.textAlign = 'center';
            lblCtx.fillText(data.name, 128, 40);
            
            const lblTex = new THREE.CanvasTexture(lblCanvas);
            const lblMat = new THREE.SpriteMaterial({ 
                map: lblTex,
                transparent: true
            });
            const lblSprite = new THREE.Sprite(lblMat);
            lblSprite.scale.set(10, 2.5, 1);
            lblSprite.position.y = data.radius + 3;
            planetGroup.add(lblSprite);
            labels.push(lblSprite);
            
            scene.add(planetGroup);
            planets.push(planetGroup);
        }
        
        function createAsteroidBelt() {
            const asteroidGroup = new THREE.Group();
            asteroidGroup.name = 'asteroidBelt';
            
            for (let i = 0; i < 500; i++) {
                const astGeom = new THREE.IcosahedronGeometry(0.15, Math.floor(Math.random() * 2) + 4);
                const colorValue = 0.3 + Math.random() * 0.2;
                const astMat = new THREE.MeshPhongMaterial({ 
                    color: new THREE.Color(colorValue, colorValue * 0.9, colorValue * 0.85),
                    shininess: 5,
                    specular: 0x111111
                });
                
                const asteroid = new THREE.Mesh(astGeom, astMat);
                const angle = Math.random() * Math.PI * 2;
                const distance = 35 + Math.random() * 8 - 4;
                const verticalOffset = (Math.random() - 0.5) * 2;
                
                asteroid.position.x = Math.cos(angle) * distance;
                asteroid.position.z = Math.sin(angle) * distance;
                asteroid.position.y = verticalOffset;
                
                asteroid.rotation.x = Math.random() * Math.PI;
                asteroid.rotation.y = Math.random() * Math.PI;
                asteroid.rotation.z = Math.random() * Math.PI;
                
                const scale = 0.3 + Math.random();
                asteroid.scale.set(scale, scale, scale);
                
                asteroid.userData = { 
                    angle, 
                    distance, 
                    speed: Math.random() * 0.3 + 0.1,
                    verticalOffset,
                    rotationSpeed: {
                        x: (Math.random() - 0.5) * 0.02,
                        y: (Math.random() - 0.5) * 0.02,
                        z: (Math.random() - 0.5) * 0.02
                    }
                };
                
                asteroid.castShadow = true;
                asteroid.receiveShadow = true;
                asteroidGroup.add(asteroid);
                asteroids.push(asteroid);
            }
            
            scene.add(asteroidGroup);
            asteroidEffects.push(asteroidGroup);
            
            const beltPath = new THREE.EllipseCurve(0, 0, 35, 35, 0, 2 * Math.PI, false, 0);
            const beltPoints = beltPath.getPoints(256);
            const beltGeometry = new THREE.BufferGeometry().setFromPoints(beltPoints);
            
            const beltMaterial = new THREE.LineBasicMaterial({
                color: 0x999999,
                linewidth: 3,
                fog: false
            });
            
            const beltLine = new THREE.Line(beltGeometry, beltMaterial);
            beltLine.rotation.x = Math.PI / 2;
            beltLine.renderOrder = -50;
            beltLine.frustumCulled = false;
            scene.add(beltLine);
            asteroidEffects.push(beltLine);
            
            const dustGeometry = new THREE.TorusGeometry(35, 4, 2, 80);
            const dustMaterial = new THREE.MeshBasicMaterial({
                color: 0x777777,
                transparent: true,
                opacity: 0.08,
                side: THREE.DoubleSide,
                depthWrite: false
            });
            const dust = new THREE.Mesh(dustGeometry, dustMaterial);
            dust.rotation.x = Math.PI / 2;
            dust.renderOrder = 1;
            scene.add(dust);
            asteroidEffects.push(dust);
        }
        
        function createPlanetaryRings() {
            const saturn = planets.find(p => p.userData && p.userData.name === '×©×‘×ª××™');
            if (saturn) {
                const ringGeometry = new THREE.RingGeometry(6, 10, 64, 1);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0xDDB777,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.7,
                    depthWrite: false
                });
                const rings = new THREE.Mesh(ringGeometry, ringMaterial);
                rings.rotation.x = Math.PI / 2.2;
                rings.renderOrder = 10;
                saturn.children[0].add(rings);
            }
            
            const uranus = planets.find(p => p.userData && p.userData.name === '××•×¨× ×•×¡');
            if (uranus) {
                const uRingGeometry = new THREE.RingGeometry(2.5, 3.5, 32);
                const uRingMaterial = new THREE.MeshBasicMaterial({
                    color: 0x4488AA,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.3,
                    depthWrite: false
                });
                const uRings = new THREE.Mesh(uRingGeometry, uRingMaterial);
                uRings.rotation.x = Math.PI / 2;
                uRings.renderOrder = 10;
                uranus.children[0].add(uRings);
            }
            
            const neptune = planets.find(p => p.userData && p.userData.name === '× ×¤×˜×•×Ÿ');
            if (neptune) {
                const nRingGeometry = new THREE.RingGeometry(2.5, 3, 32);
                const nRingMaterial = new THREE.MeshBasicMaterial({
                    color: 0x3366AA,
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.15,
                    depthWrite: false
                });
                const nRings = new THREE.Mesh(nRingGeometry, nRingMaterial);
                nRings.rotation.x = Math.PI / 2;
                nRings.renderOrder = 10;
                neptune.children[0].add(nRings);
            }
        }
        
        function onPointerClick(event) {
            if (isDragging && event.type === 'click') return;
            
            if (event.type === 'touchend') {
                if (event.changedTouches.length === 0) return;
                mouse.x = (event.changedTouches[0].clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.changedTouches[0].clientY / window.innerHeight) * 2 + 1;
            } else {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            }
            
            raycaster.setFromCamera(mouse, camera);
            
            // ×‘×“×™×§×ª ×œ×—×™×¦×” ×¢×œ ×›×•×›×‘×™ ×œ×›×ª ×•×”×©××©
            const planetMeshes = planets.map(p => p.children[0]);
            const clickableObjects = [...planetMeshes, sun];
            const intersects = raycaster.intersectObjects(clickableObjects);
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                const data = clickedObject.userData;
                
                // ×‘×“×™×§×” ×× ×œ×—×¦× ×• ×¢×œ ×”×©××©
                if (clickedObject === sun) {
                    selectedPlanet = sunGroup;
                } else {
                    selectedPlanet = clickedObject.parent;
                }
                
                document.getElementById('planet-name').textContent = data.name;
                document.getElementById('planet-diameter').textContent = data.diameter;
                document.getElementById('planet-distance').textContent = data.realDistance;
                document.getElementById('planet-period').textContent = data.period;
                document.getElementById('planet-day').textContent = data.dayLength;
                document.getElementById('planet-moons').textContent = data.moons;
                document.getElementById('planet-temp').textContent = data.temp;
                document.getElementById('planet-mass').textContent = data.mass;
                document.getElementById('planet-gravity').textContent = data.gravity;
                document.getElementById('planet-composition').textContent = data.composition;
                document.getElementById('planet-atmosphere').textContent = data.atmosphere;
                document.getElementById('planet-facts').textContent = data.facts;
                
                const eccentricityText = data.eccentricity !== undefined ? 
                    (data.eccentricity === 0 ? '×œ× ×¨×œ×•×•× ×˜×™ - ××¨×›×– ×”××¢×¨×›×ª' :
                     data.eccentricity.toFixed(3) + 
                     (data.eccentricity < 0.02 ? ' (×›××¢×˜ ××¢×’×œ×™)' : 
                      data.eccentricity > 0.1 ? ' (××œ×™×¤×˜×™ ×××•×“)' : ' (××œ×™×¤×˜×™ ××¢×˜)')) : '×œ× ×¨×œ×•×•× ×˜×™';
                document.getElementById('planet-eccentricity').textContent = eccentricityText;
                
                document.getElementById('info-panel').style.display = 'block';
                
                // ××™×§×•× ×”××¦×œ××” ×œ×¦×¤×™×™×” ×‘××•×‘×™×™×§×˜
                const targetPosition = selectedPlanet.position.clone();
                const viewDistance = data.radius ? data.radius * 10 : 50;
                camera.position.set(
                    targetPosition.x + viewDistance,
                    targetPosition.y + viewDistance * 0.5,
                    targetPosition.z + viewDistance
                );
                camera.lookAt(targetPosition);
            }
        }
        
        function setupTouchControls() {
            if (!renderer || !renderer.domElement) return;
            
            let touchStartX = 0;
            let touchStartY = 0;
            let startAngleH = 0;
            let startAngleV = 0;
            let hasDragged = false;
            
            renderer.domElement.addEventListener('touchstart', (e) => {
                hasDragged = false;
                
                if (e.touches.length === 2) {
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    touchStartDistance = Math.sqrt(dx * dx + dy * dy);
                } else if (e.touches.length === 1) {
                    touchStartX = e.touches[0].clientX;
                    touchStartY = e.touches[0].clientY;
                    startAngleH = cameraRotationAngle;
                    startAngleV = cameraVerticalAngle;
                }
            });
            
            renderer.domElement.addEventListener('touchmove', (e) => {
                e.preventDefault();
                
                if (e.touches.length === 2) {
                    const dx = e.touches[0].clientX - e.touches[1].clientX;
                    const dy = e.touches[0].clientY - e.touches[1].clientY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (touchStartDistance > 0) {
                        const scale = touchStartDistance / distance;
                        const newDistance = Math.max(50, Math.min(500, currentCameraDistance * scale));
                        currentCameraDistance = newDistance;
                        updateCameraPosition();
                        document.getElementById('zoom-slider').value = newDistance;
                        touchStartDistance = distance;
                        hasDragged = true;
                        isDragging = true;
                    }
                } else if (e.touches.length === 1) {
                    const deltaX = e.touches[0].clientX - touchStartX;
                    const deltaY = e.touches[0].clientY - touchStartY;
                    
                    if (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10) {
                        hasDragged = true;
                        isDragging = true;
                        
                        cameraRotationAngle = startAngleH - deltaX * 0.01;
                        cameraVerticalAngle = Math.max(-1.3, Math.min(1.3, startAngleV - deltaY * 0.005));
                        
                        updateCameraPosition();
                    }
                }
            });
            
            renderer.domElement.addEventListener('touchend', (e) => {
                touchStartDistance = 0;
                if (hasDragged) {
                    setTimeout(() => {
                        isDragging = false;
                    }, 100);
                }
            });
        }
        
        function setupMouseControls() {
            if (!renderer || !renderer.domElement) return;
            
            let mouseDown = false;
            let mouseX = 0;
            let mouseY = 0;
            let startAngleH = 0;
            let startAngleV = 0;
            let hasDragged = false;
            
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 1.1 : 0.9;
                currentCameraDistance = Math.max(50, Math.min(500, currentCameraDistance * delta));
                updateCameraPosition();
                document.getElementById('zoom-slider').value = currentCameraDistance;
            });
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                if (e.button === 0) {
                    mouseDown = true;
                    hasDragged = false;
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                    startAngleH = cameraRotationAngle;
                    startAngleV = cameraVerticalAngle;
                    renderer.domElement.style.cursor = 'grabbing';
                }
            });
            
            window.addEventListener('mousemove', (e) => {
                if (mouseDown) {
                    const deltaX = e.clientX - mouseX;
                    const deltaY = e.clientY - mouseY;
                    
                    if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
                        hasDragged = true;
                        isDragging = true;
                        
                        cameraRotationAngle = startAngleH - deltaX * 0.01;
                        cameraVerticalAngle = Math.max(-1.3, Math.min(1.3, startAngleV - deltaY * 0.005));
                        
                        updateCameraPosition();
                    }
                }
            });
            
            window.addEventListener('mouseup', () => {
                mouseDown = false;
                if (hasDragged) {
                    setTimeout(() => {
                        isDragging = false;
                    }, 100);
                }
                renderer.domElement.style.cursor = 'grab';
            });
            
            renderer.domElement.style.cursor = 'grab';
        }
        
        function updateCameraPosition() {
            if (selectedPlanet) return;
            
            camera.position.x = Math.sin(cameraRotationAngle) * Math.cos(cameraVerticalAngle) * currentCameraDistance;
            camera.position.y = Math.sin(cameraVerticalAngle) * currentCameraDistance;
            camera.position.z = Math.cos(cameraRotationAngle) * Math.cos(cameraVerticalAngle) * currentCameraDistance;
            camera.lookAt(0, 0, 0);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (!isPaused) {
                const currentTime = (Date.now() - startTime) * 0.0001;
                
                if (sun) {
                    sun.rotation.y += 0.001 * speedMultiplier;
                    const pulse = Math.sin(Date.now() * 0.001) * 0.02;
                    sun.scale.set(1 + pulse, 1 + pulse, 1 + pulse);
                    
                    // ××¤×§×˜ ×¡×™×‘×•×‘ ×œ×”×™×œ×”
                    if (sunGroup && sunGroup.children.length > 1) {
                        for (let i = 1; i < sunGroup.children.length - 1; i++) {
                            sunGroup.children[i].rotation.y += 0.0005 * speedMultiplier * i;
                        }
                    }
                }
                
                planets.forEach((planetGroup) => {
                    const data = planetGroup.userData;
                    
                    // ×ª×™×§×•×Ÿ: ×¢×“×›×•×Ÿ ×–×•×•×™×ª ×”×›×•×›×‘
                    data.angle += speedMultiplier * data.speed * 0.001;
                    const meanAnomaly = data.angle % (2 * Math.PI);
                    
                    // ×—×™×©×•×‘ Kepler's equation
                    let eccentricAnomaly = meanAnomaly;
                    for (let i = 0; i < 5; i++) {
                        eccentricAnomaly = meanAnomaly + data.eccentricity * Math.sin(eccentricAnomaly);
                    }
                    
                    const trueAnomaly = 2 * Math.atan2(
                        Math.sqrt(1 + data.eccentricity) * Math.sin(eccentricAnomaly / 2),
                        Math.sqrt(1 - data.eccentricity) * Math.cos(eccentricAnomaly / 2)
                    );
                    
                    const radius = data.distance * (1 - data.eccentricity * data.eccentricity) / 
                                 (1 + data.eccentricity * Math.cos(trueAnomaly));
                    
                    planetGroup.position.x = radius * Math.cos(trueAnomaly) - data.distance * data.eccentricity;
                    planetGroup.position.z = radius * Math.sin(trueAnomaly);
                    
                    // ×¡×™×‘×•×‘ ×¢×¦××™
                    planetGroup.children[0].rotation.y += data.rotationSpeed * speedMultiplier;
                    
                    // ×¢× × ×™×
                    if (data.hasClouds && planetGroup.children[0].children[0]) {
                        planetGroup.children[0].children[0].rotation.y += 0.002 * speedMultiplier;
                    }
                    
                    // ×”×™×¨×—
                    if (planetGroup.userData.moon) {
                        const moonTime = Date.now() * 0.001 * speedMultiplier;
                        planetGroup.userData.moon.position.x = Math.cos(moonTime) * 2;
                        planetGroup.userData.moon.position.z = Math.sin(moonTime) * 2;
                        planetGroup.userData.moon.rotation.y += 0.005 * speedMultiplier;
                    }
                    
                    // ×˜×‘×¢×•×ª
                    planetGroup.children[0].children.forEach(child => {
                        if (child.geometry && child.geometry.type === 'RingGeometry') {
                            child.rotation.z += 0.0005 * speedMultiplier;
                        }
                    });
                });
                
                // ××¡×˜×¨×•××™×“×™×
                asteroids.forEach(asteroid => {
                    if (asteroid.type === 'Mesh' && asteroid.userData && asteroid.userData.speed) {
                        const time = currentTime * speedMultiplier * asteroid.userData.speed;
                        const wobble = Math.sin(time * 5) * 0.5;
                        
                        asteroid.position.x = Math.cos(time + asteroid.userData.angle) * asteroid.userData.distance;
                        asteroid.position.z = Math.sin(time + asteroid.userData.angle) * asteroid.userData.distance;
                        asteroid.position.y = asteroid.userData.verticalOffset + wobble;
                        
                        asteroid.rotation.x += asteroid.userData.rotationSpeed.x * speedMultiplier;
                        asteroid.rotation.y += asteroid.userData.rotationSpeed.y * speedMultiplier;
                        asteroid.rotation.z += asteroid.userData.rotationSpeed.z * speedMultiplier;
                    }
                });
            }
            
            // ×¡×™×‘×•×‘ ××•×˜×•××˜×™ ××™×˜×™ ×©×œ ×”××¦×œ××”
            if (!selectedPlanet && !isDragging && !isPaused) {
                cameraRotationAngle += 0.001;
                updateCameraPosition();
            }
            
            renderer.render(scene, camera);
        }
        
        // Event handlers
        document.getElementById('menu-toggle').addEventListener('click', () => {
            document.getElementById('controls').classList.toggle('collapsed');
        });
        
        document.getElementById('speed-slider').addEventListener('input', (e) => {
            speedMultiplier = parseFloat(e.target.value);
            document.getElementById('speed-value').textContent = speedMultiplier.toFixed(1);
        });
        
        document.getElementById('zoom-slider').addEventListener('input', (e) => {
            currentCameraDistance = parseFloat(e.target.value);
            updateCameraPosition();
        });
        
        document.getElementById('pause-btn').addEventListener('click', () => {
            isPaused = !isPaused;
            document.getElementById('pause-btn').innerHTML = isPaused ? 'â–¶ï¸ ×”×¤×¢×œ' : 'â¸ï¸ ×”×©×”×”';
        });
        
        document.getElementById('reset-btn').addEventListener('click', () => {
            currentCameraDistance = 200;
            cameraRotationAngle = 0;
            cameraVerticalAngle = 0.3;
            updateCameraPosition();
            selectedPlanet = null;
            document.getElementById('info-panel').style.display = 'none';
            document.getElementById('zoom-slider').value = 200;
            
            // ××™×¤×•×¡ ×’×•×“×œ ×”×©××© ×‘××§×¨×” ×©×œ pulse
            if (sun) {
                sun.scale.set(1, 1, 1);
            }
        });
        
        // ×›×¤×ª×•×¨ ×œ×”×¡×ª×¨×ª ×¡×¨×’×œ×™×
        document.getElementById('ruler-toggle-btn').addEventListener('click', () => {
            showRulers = !showRulers;
            const controls = document.getElementById('controls');
            if (showRulers) {
                controls.classList.remove('ruler-hidden');
            } else {
                controls.classList.add('ruler-hidden');
            }
            document.getElementById('ruler-toggle-btn').classList.toggle('active');
        });
        
        document.getElementById('orbits-btn').addEventListener('click', () => {
            showOrbits = !showOrbits;
            orbits.forEach(orbit => orbit.visible = showOrbits);
            document.getElementById('orbits-btn').classList.toggle('active');
        });
        
        document.getElementById('asteroid-btn').addEventListener('click', () => {
            showAsteroids = !showAsteroids;
            asteroidEffects.forEach(effect => {
                if (effect) effect.visible = showAsteroids;
            });
            document.getElementById('asteroid-btn').classList.toggle('active');
        });
        
        document.getElementById('labels-btn').addEventListener('click', () => {
            showLabels = !showLabels;
            labels.forEach(label => label.visible = showLabels);
            document.getElementById('labels-btn').classList.toggle('active');
        });
        
        document.querySelector('.close-btn').addEventListener('click', () => {
            document.getElementById('info-panel').style.display = 'none';
            selectedPlanet = null;
        });
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // PWA Installation - ×”×•×¡×¨ ×›×™ ×“×•×¨×© Service Worker
        // ×× ×ª×¨×¦×” ×œ×”×¤×•×š ××ª ×”××¤×œ×™×§×¦×™×” ×œ-PWA, ×ª×¦×˜×¨×š ×œ×”×¢×œ×•×ª ××•×ª×” ×œ×©×¨×ª ×¢× Service Worker × ×¤×¨×“
        
        // PWA Installation
        let deferredPrompt;
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('install-prompt').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('install-prompt').style.display = 'none';
            }, 10000);
        });
        
        document.getElementById('install-btn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('install-prompt').style.display = 'none';
            }
        });
        
        // Service Worker Registration - ×™×¢×‘×•×“ ×¨×§ ×›×©×”××ª×¨ ×¢×œ ×©×¨×ª
        if ('serviceWorker' in navigator && window.location.protocol.startsWith('http')) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
        
        // Initialize
        init();
        animate();
        
        // Hide touch controls hint after interaction
        let touchHintTimeout = setTimeout(() => {
            document.getElementById('touch-controls').style.display = 'none';
        }, 5000);
        
        if (renderer && renderer.domElement) {
            renderer.domElement.addEventListener('touchstart', () => {
                clearTimeout(touchHintTimeout);
                document.getElementById('touch-controls').style.display = 'none';
            });
        }
    </script>
</body>
</html>
